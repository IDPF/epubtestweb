{% extends 'base.html' %}
{% load assignments %}
{% load filters %}

{% block content %}

<h1 id="top">{{reading_system.name}} 
{{reading_system.version}} /  
{{reading_system.operating_system}} 
</h1>

<h2>{{testsuite.name}}</h2>

{% if evaluations|length > 1 %}

<p>There are {{evaluations | length}} evaluations</p>

{% else %}
<nav class="category-list">
    <p class="small">Click on a category to view the detailed support summary below.</p>
    <table class="category-summary">
        <thead>
            <tr>
                <th>Category</th>
                <th>Score</th>
            </tr>
        </thead>
        <tbody>
{% for evaluation in evaluations %}
    {% for category in categories %}
        {% get_score evaluation category as category_score %}
            <tr>
                <td><a href="#{{category.category_id}}">{{category.name}}</a></td>
                <td>{{category_score.percent | floatformat}}%</td>
            </tr>
    {% endfor %}
{% endfor %}
        </tbody>
    </table>
</nav>
{% endif %}

{% if evaluations|length > 1 %}
<div id="evaluations">
<p>Select a tab to view evaluation:</p>
<ul id="eval-nav">
    {% for evaluation in evaluations %}
    {% get_metadata evaluation as metadata %}
    <li><a href="#eval_{{evaluation.id}}">
    {% if metadata.assistive_technology = "" %}
    (Unknown)
    {% else %}
    {{metadata.assistive_technology}}
    {% endif %}
    </a></li>
    {% endfor %}
</ul>
{% endif %}

{% for evaluation in evaluations %}

<div id="eval_{{evaluation.id}}">

{% get_metadata evaluation as metadata %}
{% if metadata != None %}
<dl>
    <dt>Assistive technology</dt>
    <dd>{{ metadata.assistive_technology }}</dd>
    
    <dt>Assistive technology features</dt>
    <dd>{{metadata | get_AT_metadata_description}}</dd>
    
    <dt>View results</dt>
    <dd>
        {% for category in categories %}
        {% get_score evaluation category as category_score %}
        {% if forloop.counter > 1 %}
        |
        {% endif %}
        <a href="#{{category.category_id}}">{{category.name}}</a>
        {% endfor %}
    </dd>
</dl>
{% endif %}

{% for category in categories %}

{% get_score evaluation category as category_score %}

{% if evaluations|length > 1 %}
<h3 id="eval_{{evaluation.id}}_cat_{{category.category_id}}" class="rs-category">{{category.name}}</h3>
{% else %}
<h2 id="eval_{{evaluation.id}}_cat_{{category.category_id}}" class="rs-category">{{category.name}}</h2>
{% endif %}

<table class="table table-condensed">
    <thead>
        <tr>
            <th class="feature-hd">Feature</th>
            <th class="test-hd">Test</th>
            <th class="result-hd">Result</th>
        </tr>
    </thead>
    <tfoot>
        <tr class="score">
            <th colspan="2">Cumulative Score</th>
            <td class="score">{{category_score.percent | floatformat}}%</td>
        </tr>
    </tfoot>
    <tbody>
{% for feature in category.features %}
{% get_score evaluation feature as feature_score %}
<tr class="feature">
    <td id="{{feature.feature_id}}" colspan="2"><h3>{{feature.name}}</h3></td>
    <td class="result">{{feature_score.fraction}}</td>
</tr>
    {% for test in feature.tests %}
    {% get_result test evaluation as test_result%}
<tr>
    <td/>
    <td id="{{test.test_id}}" class="test">{{test.name}}</td>
    {% if test_result.result == "1" %}
    <td class="supported">
    {% elif test_result.result == "2" %}
    <td class="unsupported">
    {% else %}
    <td>
    {% endif %}
    {{test_result | get_result_description}}
    </td>
</tr>
    {% endfor %}
{% endfor %}
    </tbody>
</table>

{% if evaluations|length > 1 %}
<p class="top"><a href="#eval-nav">Back to Top</a></p>
{% else %}
<p class="top"><a href="#top">Back to Top</a></p>
{% endif %}
{% endfor %}
</div>
{% endfor %}

{% if evaluations|length > 1 %}
</div>
{% endif %}
<script>
    if ($('#evaluations')) {
        $(function() {
            
            $('#evaluations').tabs({
            });
            
            if(document.location.hash){
                var hash_id = document.location.hash;
                var re = /#(eval_[0-9]+)_/i;
                var match = re.exec(hash_id);
                if (match.length > 0) {
                    var tab = match[1];
                    $('#evaluations').tabs('option', 'active', $(tab).index());
                    $(document.location.hash)[0].scrollIntoView();
                }
            }
        });
    }
</script>
{% endblock %}
