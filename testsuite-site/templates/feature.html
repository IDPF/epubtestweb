{% extends 'base.html' %}
{% load assignments %}
{% load filters %}

{% block content %}

<h1>{{feature.name}}</h1>

<div id="tblChange" style="margin-top: 1rem;">
    <p class="small">
        <span style="padding-right: 1rem;">Table view:</span>
        <a class="normal" href="#hd" id="hd" onclick="changeView('hd'); return false">Fixed Header</a> |
        <a class="normal" href="#col" id="col" onclick="changeView('col'); return false">Scrolled</a>
    </p>
    
    <p class="small italic">Note: The scrolled view is best for wide tables, but is less accessible for users of assistive technologies.</p>
</div>

<table id="feature" class="table table-feature">
    <thead>
        <th class="rs">Reading System</th>
        <th class="pass">Tests Passed</th>
        {% for test in tests %}
        <th>{{test.name}}</th>
        {% endfor %}
    </thead>
    <tbody>
        {% for evaluation in evaluations %}
        <tr>
            <th class="rs">
                <a href="/evaluation/{{evaluation.id}}">{{evaluation.reading_system | get_reading_system_display_name}}</a>
            <br/>
            {% get_metadata evaluation as metadata %}
            {% if metadata != None %}
            <span>{{metadata.assistive_technology}}</span>
            {% endif %}
            </th>
            {% get_score evaluation feature as feature_score %}
            <td class="pass">{{feature_score.fraction}}</td>
            {% for test in tests %}
            {% get_result test evaluation as result %}
            {% if result.result == "1" %}
            <td class="supported">
            {% elif result.result == "2" %}
            <td class="unsupported">
            {% else %}
            <td class="other">
            {% endif %}
                 {{result | get_result_description}}
            </td>
            {% endfor %}
        </tr>
        {% endfor %}
    </tbody>
</table>

<script>
    $(document).ready(function(){
        var tblType = Cookies.get('tblType'); ;
        
        if (typeof(tblType) == 'undefined' || tblType == null || tblType == '') {
            Cookies.set('tblType', 'hd', { expires: 365 });
        }
        
        if (tblType == 'col') {
            initDataTable(false,true,true,true,'','');
            setTableViewLinks('col','hd');
        }
        else {
            initDataTable(true,false,true,true,'','');
            setTableViewLinks('hd','col');
        }
        
        var isMobile = window.matchMedia("only screen and (max-width: 760px)");
        if (isMobile.matches) {
            $('#tblChange').hide();
        }
    });
    
    function changeView(type) {
        var table = $('#feature').DataTable();
        table.destroy();
        
        if (type == 'col') {
            initDataTable(false,true,true,true,'','');
            Cookies.set('tblType', 'col', { expires: 365 });
            setTableViewLinks('col','hd');
        }
        else {
            initDataTable(true,false,true,true,'','');
            Cookies.set('tblType', 'hd', { expires: 365 });
            setTableViewLinks('hd','col');
        }
    }
    
    function setTableViewLinks(active, inactive) {
        $('#'+active).unbind('click');
        $('#'+active).addClass('inactiveLink');
        $('#'+inactive).bind('click');
        $('#'+inactive).removeClass('inactiveLink');
    }
</script>

{% endblock %}
